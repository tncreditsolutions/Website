# TN Credit Solutions - Production Deployment Guide

This guide explains how to deploy the TN Credit Solutions website outside of Replit to your own server or hosting provider.

## Prerequisites

- Node.js 18+ 
- PostgreSQL database
- npm or yarn package manager

## Deployment Steps

### 1. Clone/Export Your Repository

Export your project from Replit to GitHub, then clone it:

```bash
git clone <your-repository-url>
cd <your-project-directory>
```

### 2. Environment Configuration

Create a `.env` file in the root directory with your production settings:

```bash
cp .env.example .env
```

Edit `.env` with your actual values:

```
DATABASE_URL=postgresql://user:password@your-host:5432/database_name
NODE_ENV=production
PORT=5000
SESSION_SECRET=generate-a-random-secret-key-here
```

**Important**: 
- Generate a strong `SESSION_SECRET` - use a random string generator
- Keep `.env` file secure and never commit it to version control
- Update `.gitignore` to include `.env` files

### 3. Install Dependencies

```bash
npm install
```

### 4. Build the Application

```bash
npm run build
```

This command:
- Builds the React frontend with Vite
- Bundles the Express backend with esbuild
- Creates optimized files in the `dist/` directory

### 5. Database Setup

#### Option A: Using Neon (Recommended for easy PostgreSQL)

1. Create a free PostgreSQL database at [neon.tech](https://neon.tech)
2. Copy your connection string
3. Set it as `DATABASE_URL` in your `.env` file

#### Option B: Self-Hosted PostgreSQL

1. Install PostgreSQL on your server
2. Create a new database:
   ```bash
   createdb tn_credit_solutions
   ```
3. Create a database user with connection string: `postgresql://user:password@localhost:5432/tn_credit_solutions`
4. Set it as `DATABASE_URL` in your `.env` file

### 6. Push Database Schema

```bash
npm run db:push
```

This creates all necessary database tables from the Drizzle ORM schema.

### 7. Start the Application

```bash
npm start
```

Your application will be available at `http://localhost:5000` (or your configured PORT)

## Production Deployment Platforms

### Heroku

```bash
# Install Heroku CLI
npm install -g heroku

# Login
heroku login

# Create app
heroku create your-app-name

# Set environment variables
heroku config:set DATABASE_URL=<your-neon-connection-string>
heroku config:set SESSION_SECRET=<your-random-secret>
heroku config:set NODE_ENV=production

# Deploy
git push heroku main
```

### Railway

1. Connect your GitHub repository
2. Create a new project
3. Add PostgreSQL plugin
4. Set environment variables in the Railway dashboard
5. Deploy automatically on push

### DigitalOcean App Platform

1. Connect your GitHub repository
2. Create new app
3. Add PostgreSQL database
4. Set environment variables
5. Configure Node.js runtime
6. Deploy

### AWS EC2 / Self-Hosted

```bash
# SSH into your server
ssh user@your-server-ip

# Clone repository
git clone <your-repo-url>
cd <project>

# Install Node.js if needed
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Install PM2 for process management (optional but recommended)
npm install -g pm2

# Setup environment and install dependencies
cp .env.example .env
# Edit .env with production values
npm install

# Build
npm run build

# Start with PM2
pm2 start npm --name "tn-credit-solutions" -- start
pm2 startup
pm2 save
```

## Project Structure for Production

```
├── client/                 # React frontend
│   ├── src/
│   ├── public/
│   └── index.html
├── server/                 # Express backend
│   ├── app.ts
│   ├── index-prod.ts       # Production server entry
│   ├── routes.ts
│   └── storage.ts
├── shared/                 # Shared types/schemas
│   └── schema.ts
├── dist/                   # Built files (generated by npm run build)
├── package.json
├── vite.config.ts
├── drizzle.config.ts
└── tsconfig.json
```

## Post-Deployment

### Configure Your Domain

1. Update DNS records to point to your server
2. If using SSL/HTTPS (recommended):
   - Use Let's Encrypt with Certbot for free SSL
   - Or use your hosting provider's SSL certificate

### Monitor the Application

- Check logs: `pm2 logs` (if using PM2)
- Monitor database performance
- Set up error tracking (e.g., Sentry)
- Enable CORS for any external APIs if needed

### Backup Database

```bash
# Regular backups (add to cron job)
pg_dump $DATABASE_URL > backup_$(date +%Y%m%d).sql

# Restore from backup
psql $DATABASE_URL < backup_file.sql
```

## Troubleshooting

### Port Already in Use
```bash
# Change port in .env or find process using port 5000
lsof -i :5000
kill -9 <PID>
```

### Database Connection Issues
- Verify DATABASE_URL format
- Check database credentials
- Ensure database server is running and accessible
- Check firewall rules

### Build Failures
```bash
# Clear cache and rebuild
rm -rf dist node_modules
npm install
npm run build
```

### Static Files Not Loading
- Ensure `npm run build` completed successfully
- Check that `dist/` directory exists and contains `public/` folder
- Verify server is serving static files from correct path

## Environment Variables Reference

| Variable | Required | Description |
|----------|----------|-------------|
| DATABASE_URL | Yes | PostgreSQL connection string |
| NODE_ENV | Yes | Set to "production" for production |
| PORT | No | Server port (defaults to 5000) |
| SESSION_SECRET | Yes | Random string for session encryption |

## Support

For issues or questions about deployment:
1. Check the troubleshooting section above
2. Review server/application logs
3. Verify all environment variables are set correctly
4. Contact TN Credit Solutions support through the website

## Security Checklist

- [ ] Generate strong SESSION_SECRET
- [ ] Use HTTPS/SSL in production
- [ ] Never commit `.env` to version control
- [ ] Update Node.js and dependencies regularly
- [ ] Enable database backups
- [ ] Monitor application logs
- [ ] Use firewall rules to restrict access
- [ ] Keep sensitive data out of frontend code
- [ ] Use environment variables for all secrets
